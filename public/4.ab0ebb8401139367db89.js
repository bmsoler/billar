webpackJsonp([4],{153:function(t,e,a){function o(t){a(172)}var i=a(32)(a(158),a(177),o,"data-v-07e1b754",null);t.exports=i.exports},158:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a(56),i=a.n(o);e.default={data:function(){return{valid:!1,from:null,fromRules:[function(t){return!!t||"El origen es obligatorio"}],to:null,toRules:[function(t){return!!t||"El destino es obligatorio"}],type:null,typeRules:[function(t){return!!t||"El tipo es obligatorio"}],nodos:[],links:[],tipos:["Empresarial","Institucional","Social","Otras"],toInvalid:!1,timeout:3e3,errorText:"",search:"",headers:[{text:"",align:"right",sortable:!1},{text:"Origen",align:"left",sortable:!0,value:"nodo_from.name"},{text:"",align:"center",sortable:!1},{text:"",align:"right",sortable:!1},{text:"Destino",align:"left",sortable:!0,value:"nodo_to.name"},{text:"Tipo de relación",align:"left",sortable:!0,value:"type"},{text:"",align:"center",sortable:!1}],rows_per_page:[10,15,25,50,{text:"Todos",value:-1}],dialog:!1,link_to_delete:null,dialogAddLink:!1,dialogChangeCategory:!1,type_relation:null,formChangeType:!1,link_to_change_type:null,token:null}},mounted:function(){this.token=this.$localStorage.get("bubblesToken"),this.loadNodesForTable(),this.loadLinksForTable()},computed:{formValid:function(){return this.from&&this.to},theme:function(){return this.$store.state.fondoDialog}},filters:{capitalize:function(t){return t?t.toUpperCase():""}},methods:{openChangeCategoryDialog:function(t){this.link_to_change_type=t,this.type_relation=t.type,"Comercial"===t.type&&(this.type_relation=null),this.dialogChangeCategory=!0},openDialog:function(t){this.dialog=!0,this.link_to_delete=t},openDialogAddLink:function(t){this.dialogAddLink=!0},loadNodesForTable:function(){var t=this;i.a.get(this.$store.state.URL_NODE_SERVER+"/loadNodesForTable",{headers:{Authorization:"Bearer "+t.token}}).then(function(e){t.nodos=e.data}).catch(function(e){t.$localStorage.remove("bubblesToken"),t.$localStorage.remove("bubblesUser"),t.$localStorage.remove("bubblesImg"),t.$store.commit("loginKO"),t.$router.push("/")})},loadLinksForTable:function(){var t=this;i.a.get(this.$store.state.URL_NODE_SERVER+"/loadLinksForTable",{headers:{Authorization:"Bearer "+t.token}}).then(function(e){t.links=e.data}).catch(function(t){console.log(t)})},submit:function(){var t={from:""+this.from.id,to:""+this.to.id,id:this.from.id+"_"+this.to.id+"_d41d8cd98f00b204e9800998ecf8427e",nodo_from:this.from._id,nodo_to:this.to._id,name:this.to.name,type:this.type};this.from.id===this.to.id?(this.errorText="El destino introducido no es válido",this.toInvalid=!0,this.to=null):(this.saveLink(t),this.from=null,this.to=null,this.dialogAddLink=!1)},saveLink:function(t){var e=this,a=this;i.a.post(this.$store.state.URL_NODE_SERVER+"/addLinks",t,{headers:{Authorization:"Bearer "+a.token}}).then(function(t){a.loadLinksForTable(),a.clear()}).catch(function(t){e.errorText="Esta relación ya existe",e.toInvalid=!0})},clear:function(){this.$refs.form.reset()},pickFile:function(){this.$refs.image.click()},onFilePicked:function(t){var e=this,a=t.target.files;if(void 0!==a[0]){if(this.imageName=a[0].name,this.imageName.lastIndexOf(".")<=0)return;var o=new FileReader;o.readAsDataURL(a[0]),o.addEventListener("load",function(){e.imageUrl=o.result,e.imageFile=a[0]})}else this.imageName="",this.imageFile="",this.imageUrl=""},deleteLink:function(){var t=this;this.dialog=!1,i.a.post(this.$store.state.URL_NODE_SERVER+"/deleteLink",this.link_to_delete,{headers:{Authorization:"Bearer "+t.token}}).then(function(e){t.link_to_delete=null,t.loadLinksForTable()}).catch(function(e){console.log(e),t.link_to_delete=null})},cancelDeleteLink:function(){this.link_to_delete=null,this.dialog=!1},goToChart:function(t){this.$store.state.search=t,this.$router.push("Redes")},changeRelationType:function(){var t=this,e=this,a=this.link_to_change_type;i.a.post(this.$store.state.URL_NODE_SERVER+"/updateLink",{link:a,new_type:this.type_relation},{headers:{Authorization:"Bearer "+e.token}}).then(function(a){t.dialogChangeCategory=!1,e.loadLinksForTable()}).catch(function(t){})}}}},167:function(t,e,a){e=t.exports=a(4)(!1),e.push([t.i,".texto[data-v-07e1b754]{font-size:17px!important;font-weight:400!important}",""])},172:function(t,e,a){var o=a(167);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a(5)("4839a541",o,!0,{})},177:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-layout",{attrs:{row:"",wrap:"","align-start":"","mx-auto":""}},[a("v-flex",{staticStyle:{padding:"5px"},attrs:{"d-flex":"",xs12:"",md12:"",lg12:""}},[a("v-card",{staticClass:"widget-title fadeIn"},[a("v-toolbar",{staticStyle:{height:"100px",background:"transparent"},attrs:{dark:""}},[a("v-toolbar-title",{staticClass:"texto"},[t._v("\n            Listado de relaciones\n\n          "),a("v-tooltip",{attrs:{right:""}},[a("v-btn",{attrs:{slot:"activator",icon:""},on:{click:t.openDialogAddLink},slot:"activator"},[a("v-icon",[t._v("playlist_add")])],1),a("span",[t._v("Añadir relación")])],1)],1),a("v-spacer"),a("v-text-field",{staticStyle:{"min-width":"100px"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),a("v-btn",{attrs:{icon:""}},[a("v-icon",[t._v("search")])],1)],1),a("div",{staticStyle:{position:"absolute",right:"10px",left:"10px",top:"60px"}},[a("v-data-table",{attrs:{"rows-per-page-text":"Filas por página","rows-per-page-items":t.rows_per_page,headers:t.headers,items:t.links,search:t.search},scopedSlots:t._u([{key:"items",fn:function(e){return e.item.nodo_from&&e.item.nodo_to?[a("td",{staticStyle:{width:"30px","padding-top":"5px","padding-bottom":"5px"}},[a("v-avatar",{staticClass:"grey lighten-4",attrs:{size:"30"}},[e.item.nodo_from.image?a("img",{staticStyle:{width:"50px",height:"50px"},attrs:{src:e.item.nodo_from.image,alt:""}}):t._e()])],1),a("td",[t._v("\n                "+t._s(e.item.nodo_from.name))]),a("td",[a("i",{staticClass:"material-icons",staticStyle:{"font-size":"35px",color:"#0277BD !important"}},[t._v("trending_flat")])]),a("td",{staticStyle:{width:"30px","padding-top":"5px","padding-bottom":"5px"}},[a("v-avatar",{staticClass:"grey lighten-4",attrs:{size:"30"}},[e.item.nodo_to.image?a("img",{staticStyle:{width:"50px",height:"50px"},attrs:{src:e.item.nodo_to.image,alt:""}}):t._e()])],1),a("td",[t._v(t._s(e.item.nodo_to.name))]),a("td",[a("v-tooltip",{attrs:{left:""}},[a("v-btn",{attrs:{slot:"activator",small:"",color:"white",icon:""},on:{click:function(a){t.openChangeCategoryDialog(e.item)}},slot:"activator"},[a("v-icon",{staticStyle:{"font-size":"20px",color:"purple !important"},attrs:{color:"purple"}},[t._v("mode_edit")])],1),a("span",[t._v("Cambiar el tipo de la relación")])],1),t._v("\n                "+t._s(t._f("capitalize")(e.item.type))+"                                 \n                ")],1),a("td",[a("v-tooltip",{attrs:{left:""}},[a("v-btn",{attrs:{slot:"activator",small:"",color:"white",icon:""},on:{click:function(a){t.goToChart(e.item.name)}},slot:"activator"},[a("v-icon",{staticStyle:{"font-size":"20px",color:"#81c784 !important"},attrs:{color:"green lighten-2"}},[t._v("share")])],1),a("span",[t._v("Mostrar en bubbles")])],1),a("v-tooltip",{attrs:{left:""}},[a("v-btn",{attrs:{slot:"activator",small:"",color:"white",icon:""},on:{click:function(a){t.openDialog(e.item)}},slot:"activator"},[a("v-icon",{staticStyle:{color:"grey !important","font-size":"20px"}},[t._v("delete_sweep")])],1),a("span",[t._v("Eliminar relación")])],1)],1)]:void 0}}])},[a("v-alert",{attrs:{slot:"no-results",value:!0,color:"info",icon:"warning"},slot:"no-results"},[t._v('\n              La búsqueda de "'+t._s(t.search)+'" no ha obtenido resultados.\n            ')])],1)],1)],1)],1)],1),a("v-dialog",{attrs:{"max-width":"60%"},model:{value:t.dialogAddLink,callback:function(e){t.dialogAddLink=e},expression:"dialogAddLink"}},[a("v-card",{class:t.theme,attrs:{dark:""}},[a("v-card-title",[a("span",{staticClass:"headline"},[t._v("Nueva relación")])]),a("v-card-text",[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[a("v-select",{attrs:{items:t.tipos,"item-text":"tipo",label:"Tipo",autocomplete:"",rules:t.typeRules,required:""},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}}),a("v-select",{attrs:{items:t.nodos,"item-text":"name",label:"Origen",autocomplete:"",rules:t.fromRules,required:""},model:{value:t.from,callback:function(e){t.from=e},expression:"from"}}),a("v-select",{attrs:{items:t.nodos,"item-text":"name",label:"Destino",autocomplete:"",rules:t.toRules,required:""},model:{value:t.to,callback:function(e){t.to=e},expression:"to"}}),a("v-btn",{staticStyle:{"margin-top":"30px"},attrs:{disabled:!t.formValid},on:{click:t.submit}},[t._v("\n            Guardar\n          ")]),a("v-btn",{staticStyle:{"margin-top":"30px"},nativeOn:{click:function(e){t.dialogAddLink=!1}}},[t._v("Cancelar")])],1)],1)],1)],1),a("v-dialog",{attrs:{"max-width":"50%"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[a("v-card",[a("v-card-title",{staticClass:"headline"},[t._v("¿Esta seguro de que desea borrar la relación seleccionada?")]),a("v-card-text",[t._v("Esta operación no podrá ser deshecha")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{flat:"flat"},on:{click:function(e){t.cancelDeleteLink()}}},[t._v("Cancelar")]),a("v-btn",{attrs:{color:"red",flat:"flat"},on:{click:function(e){t.deleteLink()}}},[t._v("Borrar")])],1)],1)],1),a("v-dialog",{attrs:{"max-width":"50%"},model:{value:t.dialogChangeCategory,callback:function(e){t.dialogChangeCategory=e},expression:"dialogChangeCategory"}},[a("v-card",{class:t.theme,attrs:{dark:""}},[a("v-card-title",[a("span",{staticClass:"headline"},[t._v("Seleccione el tipo de relación para este enlace")])]),a("v-card-text",[a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.formChangeType,callback:function(e){t.formChangeType=e},expression:"formChangeType"}},[a("v-select",{attrs:{items:t.tipos,"item-text":"tipo",label:"Tipo de relación",rules:t.typeRules,autocomplete:"",required:""},model:{value:t.type_relation,callback:function(e){t.type_relation=e},expression:"type_relation"}}),a("v-btn",{staticStyle:{"margin-top":"30px"},attrs:{disabled:!t.formChangeType},on:{click:t.changeRelationType}},[t._v("\n            Guardar\n          ")]),a("v-btn",{staticStyle:{"margin-top":"30px"},nativeOn:{click:function(e){t.dialogChangeCategory=!1}}},[t._v("Cancelar")])],1)],1)],1)],1),a("v-snackbar",{attrs:{timeout:t.timeout,color:"error"},model:{value:t.toInvalid,callback:function(e){t.toInvalid=e},expression:"toInvalid"}},[t._v("\n    "+t._s(t.errorText)+"\n    "),a("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(e){t.toInvalid=!1}}},[t._v("Cerrar")])],1),a("v-fab-transition",[a("v-btn",{staticStyle:{"background-color":"rgba(255, 255, 255, 0.2)"},attrs:{router:"",to:"/Redes",dark:"",fab:"",fixed:"",bottom:"",right:"",small:""}},[a("v-icon",[t._v("share")])],1)],1)],1)},staticRenderFns:[]}}});